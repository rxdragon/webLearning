# åŒå‘ç»‘å®š

- vue.js åˆ™æ˜¯é‡‡ç”¨æ•°æ®åŠ«æŒç»“åˆå‘å¸ƒè€…-è®¢é˜…è€…æ¨¡å¼çš„æ–¹å¼ï¼Œé€šè¿‡`Object.defineProperty()`æ¥åŠ«æŒå„ä¸ªå±æ€§çš„`setter`ï¼Œ`getter`ï¼Œåœ¨æ•°æ®å˜åŠ¨æ—¶å‘å¸ƒæ¶ˆæ¯ç»™è®¢é˜…è€…ï¼Œè§¦å‘ç›¸åº”çš„ç›‘å¬å›è°ƒã€‚

- vueçš„åŒå‘æ•°æ®ç»‘å®šåŸç†
  ç›‘å¬å™¨ Observer ï¼Œç”¨æ¥åŠ«æŒå¹¶ç›‘å¬æ‰€æœ‰å±æ€§ï¼ˆè½¬å˜æˆsetter/getterå½¢å¼ï¼‰ï¼Œå¦‚æœå±æ€§å‘ç”Ÿå˜åŒ–ï¼Œå°±é€šçŸ¥è®¢é˜…è€…
  
  è®¢é˜…è€… Watcherï¼Œå¯ä»¥æ”¶åˆ°å±æ€§çš„å˜åŒ–é€šçŸ¥å¹¶æ‰§è¡Œç›¸åº”çš„æ–¹æ³•ï¼Œä»è€Œæ›´æ–°è§†å›¾
  
  è§£æå™¨ Compileï¼Œå¯ä»¥è§£ææ¯ä¸ªèŠ‚ç‚¹çš„ç›¸å…³æŒ‡ä»¤ï¼Œå¯¹æ¨¡æ¿æ•°æ®å’Œè®¢é˜…å™¨è¿›è¡Œåˆå§‹åŒ–
  
  è®¢é˜…å™¨ Depï¼Œç”¨æ¥æ”¶é›†è®¢é˜…è€…ï¼Œå¯¹ç›‘å¬å™¨ Observer å’Œ è®¢é˜…è€… Watcher è¿›è¡Œç»Ÿä¸€ç®¡ç†

  ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20200318221541823.png?x-oss-process=image)

- ## æ ¸å¿ƒ

- æ˜¯é€šè¿‡Object.defineProperty() + addEventListenerï¼Œå¯¹dataçš„æ¯ä¸ªå±æ€§è¿›è¡Œäº†getã€setçš„æ‹¦æˆªã€‚å…¶å®åªç”¨Object.defineProperty()å·²ç»å¯ä»¥å®ç°åŒå‘ç»‘å®šï¼Œåªæ˜¯è¿™æ ·åšæ•ˆç‡å¾ˆä½

  ## åŸç†å›¾

  ![img](https://images2017.cnblogs.com/blog/1162184/201709/1162184-20170918135341618-553576179.png)

  vueçš„æ•°æ®åŒå‘ç»‘å®š å°†MVVMä½œä¸ºæ•°æ®ç»‘å®šçš„å…¥å£ï¼Œæ•´åˆObserverï¼ŒCompileå’ŒWatcherä¸‰è€…ï¼Œé€šè¿‡Observeræ¥ç›‘å¬è‡ªå·±çš„modelçš„æ•°æ®å˜åŒ–ï¼Œé€šè¿‡Compileæ¥è§£æç¼–è¯‘æ¨¡æ¿æŒ‡ä»¤ï¼ˆvueä¸­æ˜¯ç”¨æ¥è§£æ {{}}ï¼‰ï¼Œæœ€ç»ˆåˆ©ç”¨watcheræ­èµ·observerå’ŒCompileä¹‹é—´çš„é€šä¿¡æ¡¥æ¢ï¼Œè¾¾åˆ°æ•°æ®å˜åŒ– â€”>è§†å›¾æ›´æ–°ï¼›è§†å›¾äº¤äº’å˜åŒ–ï¼ˆinputï¼‰â€”>æ•°æ®modelå˜æ›´åŒå‘ç»‘å®šæ•ˆæœã€‚

  - observerç”¨æ¥å®ç°å¯¹æ¯ä¸ªvueä¸­çš„dataä¸­å®šä¹‰çš„å±æ€§å¾ªç¯ç”¨Object.defineProperty()å®ç°æ•°æ®åŠ«æŒï¼Œä»¥ä¾¿åˆ©ç”¨å…¶ä¸­çš„setterå’Œgetterï¼Œç„¶åé€šçŸ¥è®¢é˜…è€…ï¼Œè®¢é˜…è€…ä¼šè§¦å‘å®ƒçš„updateæ–¹æ³•ï¼Œå¯¹è§†å›¾è¿›è¡Œæ›´æ–°ã€‚

  - æˆ‘ä»¬ä»‹ç»ä¸ºä»€ä¹ˆè¦è®¢é˜…è€…ï¼Œåœ¨vueä¸­v-modelï¼Œv-nameï¼Œ{{}}ç­‰éƒ½å¯ä»¥å¯¹æ•°æ®è¿›è¡Œæ˜¾ç¤ºï¼Œä¹Ÿå°±æ˜¯è¯´å‡å¦‚ä¸€ä¸ªå±æ€§éƒ½é€šè¿‡è¿™ä¸‰ä¸ªæŒ‡ä»¤äº†ï¼Œé‚£ä¹ˆæ¯å½“è¿™ä¸ªå±æ€§æ”¹å˜çš„æ—¶å€™ï¼Œç›¸åº”çš„è¿™ä¸ªä¸‰ä¸ªæŒ‡ä»¤çš„htmlè§†å›¾ä¹Ÿå¿…é¡»æ”¹å˜ï¼Œäºæ˜¯vueä¸­å°±æ˜¯æ¯å½“æœ‰è¿™æ ·çš„å¯èƒ½ç”¨åˆ°åŒå‘ç»‘å®šçš„æŒ‡ä»¤ï¼Œå°±åœ¨ä¸€ä¸ªDepä¸­å¢åŠ ä¸€ä¸ªè®¢é˜…è€…ï¼Œå…¶è®¢é˜…è€…åªæ˜¯æ›´æ–°è‡ªå·±çš„æŒ‡ä»¤å¯¹åº”çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯v-model='name'å’Œ{{name}}æœ‰ä¸¤ä¸ªå¯¹åº”çš„è®¢é˜…è€…ï¼Œå„è‡ªç®¡ç†è‡ªå·±çš„åœ°æ–¹ã€‚æ¯å½“å±æ€§çš„setæ–¹æ³•è§¦å‘ï¼Œå°±å¾ªç¯æ›´æ–°Depä¸­çš„è®¢é˜…è€…ã€‚

  ## observerå®ç°

- ä¸»è¦æ˜¯ç»™æ¯ä¸ªvueçš„å±æ€§ç”¨Object.defineProperty()ï¼Œä»£ç å¦‚ä¸‹ï¼š

  ```js
  function defineReactive (obj, key, val) {
      var dep = new Dep();
          Object.defineProperty(obj, key, {
               get: function() {
                      //æ·»åŠ è®¢é˜…è€…watcheråˆ°ä¸»é¢˜å¯¹è±¡Dep
                      if(Dep.target) {
                          // JSçš„æµè§ˆå™¨å•çº¿ç¨‹ç‰¹æ€§ï¼Œä¿è¯è¿™ä¸ªå…¨å±€å˜é‡åœ¨åŒä¸€æ—¶é—´å†…ï¼Œåªä¼šæœ‰åŒä¸€ä¸ªç›‘å¬å™¨ä½¿ç”¨
                          dep.addSub(Dep.target);
                      }
                      return val;
               },
               set: function (newVal) {
                      if(newVal === val) return;
                      val = newVal;
                      console.log(val);
                      // ä½œä¸ºå‘å¸ƒè€…å‘å‡ºé€šçŸ¥
                      dep.notify();//é€šçŸ¥ådepä¼šå¾ªç¯è°ƒç”¨å„è‡ªçš„updateæ–¹æ³•æ›´æ–°è§†å›¾
               }
         })
  }
          function observe(obj, vm) {
              Object.keys(obj).forEach(function(key) {
                  defineReactive(vm, key, obj[key]);
              })
          }
  ```

  ## å®ç°compile

  compileçš„ç›®çš„å°±æ˜¯è§£æå„ç§æŒ‡ä»¤ç§°çœŸæ­£çš„htmlã€‚

  ```js
  function Compile(node, vm) {
      if(node) {
          this.$frag = this.nodeToFragment(node, vm);
          return this.$frag;
      }
  }
  Compile.prototype = {
      nodeToFragment: function(node, vm) {
          var self = this;
          var frag = document.createDocumentFragment();
          var child;
          while(child = node.firstChild) {
              console.log([child])
              self.compileElement(child, vm);
              frag.append(child); // å°†æ‰€æœ‰å­èŠ‚ç‚¹æ·»åŠ åˆ°fragmentä¸­
          }
          return frag;
      },
      compileElement: function(node, vm) {
          var reg = /\{\{(.*)\}\}/;
          //èŠ‚ç‚¹ç±»å‹ä¸ºå…ƒç´ (inputå…ƒç´ è¿™é‡Œ)
          if(node.nodeType === 1) {
              var attr = node.attributes;
              // è§£æå±æ€§
              for(var i = 0; i < attr.length; i++ ) {
                  if(attr[i].nodeName == 'v-model') {//éå†å±æ€§èŠ‚ç‚¹æ‰¾åˆ°v-modelçš„å±æ€§
                      var name = attr[i].nodeValue; // è·å–v-modelç»‘å®šçš„å±æ€§å
                      node.addEventListener('input', function(e) {
                          // ç»™ç›¸åº”çš„dataå±æ€§èµ‹å€¼ï¼Œè¿›è€Œè§¦å‘è¯¥å±æ€§çš„setæ–¹æ³•
                          vm[name]= e.target.value;
                      });
                      new Watcher(vm, node, name, 'value');//åˆ›å»ºæ–°çš„watcherï¼Œä¼šè§¦å‘å‡½æ•°å‘å¯¹åº”å±æ€§çš„depæ•°ç»„ä¸­æ·»åŠ è®¢é˜…è€…ï¼Œ
                  }
              };
          }
          //èŠ‚ç‚¹ç±»å‹ä¸ºtext
          if(node.nodeType === 3) {
              if(reg.test(node.nodeValue)) {
                  var name = RegExp.$1; // è·å–åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²
                  name = name.trim();
                  new Watcher(vm, node, name, 'nodeValue');
              }
          }
      }
  }
  ```

  ## watcherå®ç°

  ```js
  function Watcher(vm, node, name, type) {
      Dep.target = this;
      this.name = name;
      this.node = node;
      this.vm = vm;
      this.type = type;
      this.update();
      Dep.target = null;
  }
  
  Watcher.prototype = {
      update: function() {
          this.get();
          this.node[this.type] = this.value; // è®¢é˜…è€…æ‰§è¡Œç›¸åº”æ“ä½œ
      },
      // è·å–dataçš„å±æ€§å€¼
      get: function() {
          console.log(1)
          this.value = this.vm[this.name]; //è§¦å‘ç›¸åº”å±æ€§çš„get
      }
  }
  ```

- é¦–å…ˆæˆ‘ä»¬ä¸ºæ¯ä¸ªvueå±æ€§ç”¨Object.defineProperty()å®ç°æ•°æ®åŠ«æŒï¼Œä¸ºæ¯ä¸ªå±æ€§åˆ†é…ä¸€ä¸ªè®¢é˜…è€…é›†åˆçš„ç®¡ç†æ•°ç»„depï¼›ç„¶ååœ¨ç¼–è¯‘çš„æ—¶å€™åœ¨è¯¥å±æ€§çš„æ•°ç»„depä¸­æ·»åŠ è®¢é˜…è€…ï¼Œv-modelä¼šæ·»åŠ ä¸€ä¸ªè®¢é˜…è€…ï¼Œ{{}}ä¹Ÿä¼šï¼Œv-bindä¹Ÿä¼šï¼Œåªè¦ç”¨åˆ°è¯¥å±æ€§çš„æŒ‡ä»¤ç†è®ºä¸Šéƒ½ä¼šï¼Œæ¥ç€ä¸ºinputä¼šæ·»åŠ ç›‘å¬äº‹ä»¶ï¼Œä¿®æ”¹å€¼å°±ä¼šä¸ºè¯¥å±æ€§èµ‹å€¼ï¼Œè§¦å‘è¯¥å±æ€§çš„setæ–¹æ³•ï¼Œåœ¨setæ–¹æ³•å†…é€šçŸ¥è®¢é˜…è€…æ•°ç»„depï¼Œè®¢é˜…è€…æ•°ç»„å¾ªç¯è°ƒç”¨å„è®¢é˜…è€…çš„updateæ–¹æ³•æ›´æ–°è§†å›¾ã€‚

# keep-alive

![image-20210320214349942](https://cdn.jsdelivr.net/gh/rxdragon/webLearning/img/image-20210320214349942.png)

![image-20210320214124473](https://cdn.jsdelivr.net/gh/rxdragon/webLearning/img/image-20210320214124473.png)

![image-20210320214707600](https://cdn.jsdelivr.net/gh/rxdragon/webLearning/img/image-20210320214707600.png)

![image-20210320215509142](https://cdn.jsdelivr.net/gh/rxdragon/webLearning/img/image-20210320215509142.png)

# ç»„ä»¶é€šä¿¡æ–¹å¼

- props / $emit é€‚ç”¨ çˆ¶å­ç»„ä»¶é€šä¿¡
- ref ä¸ $parent / $children é€‚ç”¨ çˆ¶å­ç»„ä»¶é€šä¿¡
- EventBus ï¼ˆ$emit / $onï¼‰ é€‚ç”¨äº çˆ¶å­ã€éš”ä»£ã€å…„å¼Ÿç»„ä»¶é€šä¿¡
- *a**t**t**r**s*/listeners é€‚ç”¨äº éš”ä»£ç»„ä»¶é€šä¿¡

- provide / inject é€‚ç”¨äº éš”ä»£ç»„ä»¶é€šä¿¡
- Vuex é€‚ç”¨äº çˆ¶å­ã€éš”ä»£ã€å…„å¼Ÿç»„ä»¶é€šä¿¡

# watch/computedçš„åŒºåˆ«

- computedæ˜¯è®¡ç®—å±æ€§ï¼Œä¾èµ–å…¶å®ƒå±æ€§å€¼ï¼Œå¹¶ä¸” computed çš„å€¼æœ‰ç¼“å­˜ï¼Œåªæœ‰å®ƒä¾èµ–çš„å±æ€§å€¼å‘ç”Ÿæ”¹å˜ï¼Œä¸‹ä¸€æ¬¡è·å– computed çš„å€¼æ—¶æ‰ä¼šé‡æ–°è®¡ç®— computed çš„å€¼
- watchæ˜¯è§‚å¯Ÿç›‘å¬çš„ä½œç”¨ï¼Œç±»ä¼¼äºæŸäº›æ•°æ®çš„ç›‘å¬å›è°ƒ ï¼Œæ¯å½“ç›‘å¬çš„æ•°æ®å˜åŒ–æ—¶éƒ½ä¼šæ‰§è¡Œå›è°ƒè¿›è¡Œåç»­æ“ä½œ
- å½“æˆ‘ä»¬éœ€è¦è¿›è¡Œæ•°å€¼è®¡ç®—ï¼Œå¹¶ä¸”ä¾èµ–äºå…¶å®ƒæ•°æ®æ—¶ï¼Œåº”è¯¥ä½¿ç”¨ computed
- å½“æˆ‘ä»¬éœ€è¦åœ¨æ•°æ®å˜åŒ–æ—¶æ‰§è¡Œå¼‚æ­¥æˆ–å¼€é”€è¾ƒå¤§çš„æ“ä½œæ—¶ï¼Œåº”è¯¥ä½¿ç”¨ watch

# v-ifä¸v-showçš„åŒºåˆ«

- v-if æ˜¯çœŸæ­£çš„æ¡ä»¶æ¸²æŸ“ï¼Œç›´åˆ°æ¡ä»¶ç¬¬ä¸€æ¬¡å˜ä¸ºçœŸæ—¶ï¼Œæ‰ä¼šå¼€å§‹æ¸²æŸ“
- v-showæ˜¯ç”±displayæ ·å¼å†³å®šï¼Œä¸ç®¡åˆå§‹æ¡ä»¶æ˜¯ä»€ä¹ˆéƒ½ä¼šæ¸²æŸ“
- v-if é€‚ç”¨äºä¸éœ€è¦é¢‘ç¹åˆ‡æ¢æ¡ä»¶çš„åœºæ™¯ï¼›v-show åˆ™é€‚ç”¨äºéœ€è¦éå¸¸é¢‘ç¹åˆ‡æ¢æ¡ä»¶çš„åœºæ™¯

# vueä¸­çš„è·¯ç”±æ¨¡å¼

## historyæ¨¡å¼

- HTML5ä¸­çš„ä¸¤ä¸ªAPIï¼špushStateå’ŒreplaceStateï¼Œæ”¹å˜urlä¹‹åé¡µé¢ä¸ä¼šé‡æ–°åˆ·æ–°ï¼Œä¹Ÿä¸ä¼šå¸¦æœ‰#å·ï¼Œé¡µé¢åœ°å€ç¾è§‚ï¼Œurlçš„æ”¹å˜ä¼šè§¦å‘popStateäº‹ä»¶ï¼Œç›‘å¬è¯¥äº‹ä»¶ä¹Ÿå¯ä»¥å®ç°æ ¹æ®ä¸åŒçš„urlæ¸²æŸ“å¯¹åº”çš„é¡µé¢å†…å®¹
- ä½†æ˜¯å› ä¸ºæ²¡æœ‰#ä¼šå¯¼è‡´ç”¨æˆ·åœ¨åˆ·æ–°é¡µé¢çš„æ—¶å€™ï¼Œè¿˜ä¼šå‘é€è¯·æ±‚åˆ°æœåŠ¡ç«¯ï¼Œä¸ºé¿å…è¿™ç§æƒ…å†µï¼Œéœ€è¦æ¯æ¬¡urlæ”¹å˜çš„æ—¶å€™ï¼Œéƒ½å°†æ‰€æœ‰çš„è·¯ç”±é‡æ–°å®šä½åˆ°è·Ÿè·¯ç”±ä¸‹

## hashæ¨¡å¼

- url hash: http ğŸ˜•/foo.com/#help
- \#åé¢hashå€¼çš„æ”¹å˜ï¼Œå¹¶ä¸ä¼šé‡æ–°åŠ è½½é¡µé¢ï¼ŒåŒæ—¶hashå€¼çš„å˜åŒ–ä¼šè§¦å‘hashchangeäº‹ä»¶ï¼Œè¯¥äº‹ä»¶å¯ä»¥ç›‘å¬ï¼Œå¯æ ¹æ®ä¸åŒçš„å“ˆå¸Œå€¼æ¸²æŸ“ä¸åŒçš„é¡µé¢å†…å®¹

# vue 3.0ä¸­proxyæ•°æ®åŒå‘ç»‘å®š

- Proxy å¯ä»¥ç›´æ¥ç›‘å¬å¯¹è±¡è€Œéå±æ€§ï¼›
- Proxy å¯ä»¥ç›´æ¥ç›‘å¬æ•°ç»„çš„å˜åŒ–ï¼›
- Proxy æœ‰å¤šè¾¾ 13 ç§æ‹¦æˆªæ–¹æ³•,ä¸é™äº applyã€ownKeysã€deletePropertyã€has ç­‰ç­‰æ˜¯ Object.defineProperty ä¸å…·å¤‡çš„ï¼›
- Proxy è¿”å›çš„æ˜¯ä¸€ä¸ªæ–°å¯¹è±¡,æˆ‘ä»¬å¯ä»¥åªæ“ä½œæ–°çš„å¯¹è±¡è¾¾åˆ°ç›®çš„,è€Œ Object.defineProperty åªèƒ½éå†å¯¹è±¡å±æ€§ç›´æ¥ä¿®æ”¹ï¼›
- Proxy ä½œä¸ºæ–°æ ‡å‡†å°†å—åˆ°æµè§ˆå™¨å‚å•†é‡ç‚¹æŒç»­çš„æ€§èƒ½ä¼˜åŒ–ï¼Œä¹Ÿå°±æ˜¯ä¼ è¯´ä¸­çš„æ–°æ ‡å‡†çš„æ€§èƒ½çº¢åˆ©ï¼›
